<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floating Joystick Test</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #222;
    touch-action: none; /* Prevent scrolling while touching */
  }

  /* Player */
  #player {
    position: absolute;
    width: 50px;
    height: 50px;
    background: tomato;
    border-radius: 10px;
    left: calc(50% - 25px);
    top: calc(50% - 25px);
  }

  /* Joystick Outer Ring */
  #joyOuter {
    position: absolute;
    width: 120px;
    height: 120px;
    border: 4px solid rgba(255,255,255,0.4);
    border-radius: 50%;
    display: none;
    pointer-events: none;
  }

  /* Joystick Inner Dot */
  #joyInner {
    position: absolute;
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.7);
    border-radius: 50%;
    left: 30px;
    top: 30px;
    pointer-events: none;
  }
</style>
</head>
<body>

<div id="player"></div>
<div id="joyOuter">
  <div id="joyInner"></div>
</div>

<script>
const player = document.getElementById("player");
const joyOuter = document.getElementById("joyOuter");
const joyInner = document.getElementById("joyInner");

let joyActive = false;
let originX = 0, originY = 0;
let moveX = 0, moveY = 0;

function updatePlayer() {
  const speed = 3;

  let px = player.offsetLeft + moveX * speed;
  let py = player.offsetTop + moveY * speed;

  player.style.left = px + "px";
  player.style.top = py + "px";

  requestAnimationFrame(updatePlayer);
}
updatePlayer();

// Helper to get touches or mouse
function getPos(e){
  if(e.touches) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
  return { x: e.clientX, y: e.clientY };
}

// Start joystick
function start(e){
  const pos = getPos(e);
  originX = pos.x;
  originY = pos.y;
  joyOuter.style.left = (originX - 60) + "px";
  joyOuter.style.top = (originY - 60) + "px";
  joyOuter.style.display = "block";
  joyActive = true;
}

// Move joystick
function move(e){
  if(!joyActive) return;
  const pos = getPos(e);

  const dx = pos.x - originX;
  const dy = pos.y - originY;

  const dist = Math.sqrt(dx*dx + dy*dy);
  const max = 50; // inner dot radius limit

  let clampedX = dx;
  let clampedY = dy;

  if(dist > max){
    clampedX = (dx / dist) * max;
    clampedY = (dy / dist) * max;
  }

  joyInner.style.left = (clampedX + 30) + "px";
  joyInner.style.top = (clampedY + 30) + "px";

  moveX = clampedX / max;
  moveY = clampedY / max;
}

// End joystick
function end(){
  joyActive = false;
  joyOuter.style.display = "none";
  moveX = 0;
  moveY = 0;
}

// Events
document.addEventListener("mousedown", start);
document.addEventListener("mousemove", move);
document.addEventListener("mouseup", end);

document.addEventListener("touchstart", start);
document.addEventListener("touchmove", move);
document.addEventListener("touchend", end);
</script>

</body>
</html>
